defaults:
  - ../_cluster@_here_: entropy
  - ../_model/llmrandom@_here_: def_800
  - ../_trainer@_here_: llama
  - ../_dataset@_here_: c4
  - ../_checkpoints@_here_: none
  - ../_misc@_here_: default


common:
  sequence_length: 512
  batch_size: 512

  # target_dmodel: 960 # 50
  # target_dff: 3840
  # target_dmodel: 768 # 35
  # target_dff: 3072
  target_dmodel: 528 # 20
  target_dff: 2112
  # target_dmodel: 1152 # 65
  # target_dff: 4608


trainer:
  gradient_accumulation_steps: 2
  ^n_steps: 
    - 4001 # 1B tokens
    # - 8001
    # - 16001
    # - 24001

  # learning_rate: 12 # 50 1B
  # learning_rate: 11 # 35 1B
  learning_rate: 11 # 20 1B

  scheduler:
    warmup_steps: 80
  
  checkpoint:
   load:
    type: llm-random
    path: ??? # CHANGE
   save:
    type: nano
    path: ??? # CHANGE

  train_dataloader:
    tokenize_fn: 
      _target_: src.core.datasets.get_tokenize_fn
      model_name: gpt2

  eval_dataloader:
    tokenize_fn: 
      _target_: src.core.datasets.get_tokenize_fn
      model_name: gpt2


infrastructure:
  metric_logger:
    name: LLMR_HP
    tags:
      - nano
      - pc
      - llmr_800
      - hard_pruning
      # - 35p
      - 20p

  slurm: 
    job-name: ${infrastructure.metric_logger.name}
    gres: gpu:4
    time: "0-8:00:00"


apply_functions:
  - _target_: src.projected_compression.pruning.prune
    _partial_: true
    dimensions_importances_path: ??? # CHANGE
    target_dmodel: ${common.target_dmodel}
    target_dff: ${common.target_dff}